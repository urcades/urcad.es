---
import { getCollection } from "astro:content";
import Base from "../layouts/Base.astro";
import Sketch from "../components/Sketch.astro";

const pageTitle = "Ã‰. Urcades: Work";

// Get all work items, sorted by date descending (newest first)
const allWork = await getCollection("work");
const sortedWork = allWork.sort(
  (a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime()
);

// Group by year
const workByYear = sortedWork.reduce(
  (acc, item) => {
    const year = item.data.pubDate.getFullYear();
    if (!acc[year]) acc[year] = [];
    acc[year].push(item);
    return acc;
  },
  {} as Record<number, typeof sortedWork>
);

// Sort years descending
const years = Object.keys(workByYear)
  .map(Number)
  .sort((a, b) => b - a);
---

<style>
  .sketches {
    /* Use container queries for more responsive layout */
    container-type: inline-size;
    display: flex;
    flex-wrap: wrap;
    gap: 1em;

    @media (min-width: 768px) {
      justify-content: flex-start;
    }
  }
</style>

<Base pageTitle={pageTitle}>
  <p>Samples of recent work, sketching, doodling</p>

  {
    years.map((year) => (
      <>
        <h1>{year}</h1>
        <section class="sketches">
          {workByYear[year].map((item) => {
            const hasContent = item.body && item.body.trim().length > 0;
            return (
              <Sketch
                imageUrl={item.data.imageUrl}
                title={item.data.title}
                category={item.data.category}
                url={item.data.url}
                size={item.data.size}
                caseStudyUrl={hasContent ? `/work/${item.id}` : undefined}
              />
            );
          })}
        </section>
      </>
    ))
  }
</Base>
