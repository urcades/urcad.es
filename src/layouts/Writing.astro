---
import Base from "./Base.astro";
const { frontmatter } = Astro.props;

const pageTitle = frontmatter.title;
const txtColor = frontmatter.foregroundColor;
const bgColor = frontmatter.backgroundColor;
const txtColorDark = frontmatter.foregroundColorDark;
const bgColorDark = frontmatter.backgroundColorDark;

// Format date for meta tags and JSON-LD
const pubDateISO = frontmatter.pubDate instanceof Date
  ? frontmatter.pubDate.toISOString()
  : new Date(frontmatter.pubDate).toISOString();

// JSON-LD structured data for blog post
const jsonLd = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": frontmatter.title,
  "datePublished": pubDateISO,
  "description": frontmatter.description,
  "author": {
    "@type": "Person",
    "name": "Édouard Urcades",
    "email": "edouard@urcad.es",
    "url": "https://www.urcad.es/about/"
  },
  "publisher": {
    "@type": "Person",
    "name": "Édouard Urcades"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": Astro.url.href
  }
};
---

<style is:global>
  h1 {
    max-width: 22ch;
  }

  article {
    max-width: 55ch;
    text-wrap: pretty;

    /* Remove padding from last image using :has() */
    @supports selector(:has(*)) {
      &:has(img:last-child) img:last-child {
        padding-block-end: 0;
      }
    }
  }

  /* Video styling for stream posts */
  video {
    display: block;
    max-width: 100%;
    height: auto;
    margin-block-end: 1em;
  }

  blockquote {
    font-style: italic;
    padding-inline-start: 1em;
    margin-inline-start: 0;

    /* Use light-dark() for border color */
    @supports (color: light-dark(white, black)) {
      border-inline-start: 1px solid
        light-dark(
          var(--txtColor, var(--fallback-txt-color)),
          var(--txtColorDark, var(--fallback-txt-color-dark))
        );
    }

    /* Fallback for browsers without light-dark() */
    @supports not (color: light-dark(white, black)) {
      border-inline-start: 1px solid var(--txtColor, var(--fallback-txt-color));

      @media (prefers-color-scheme: dark) {
        border-inline-start-color: var(
          --txtColorDark,
          var(--fallback-txt-color-dark)
        );
      }
    }
  }

  img {
    display: inline-block;
    max-width: 100%;
    height: auto;
    padding-block-end: 1em;

    /* Fallback for browsers without :has() support */
    @supports not selector(:has(*)) {
      &:last-of-type {
        padding-block-end: 0;
      }
    }
  }

  pre {
    padding: 1em;
    overflow-x: auto;
    border-radius: 0.33em;

    /* Use light-dark() for pre background */
    @supports (color: light-dark(white, black)) {
      background-color: light-dark(#ededed, #333333);
    }

    /* Fallback for browsers without light-dark() */
    @supports not (color: light-dark(white, black)) {
      background-color: #ededed;

      @media (prefers-color-scheme: dark) {
        background-color: #333333;
      }
    }
  }

  ol ~ pre {
    margin-inline-start: 1em;
  }

  /* Reading highlight styles (from remark-highlight plugin) */
  .reading-highlight {
    font-style: italic;
    padding-inline-start: 1em;
    margin-inline-start: 0;
    margin-block: 1.5em;

    @supports (color: light-dark(white, black)) {
      border-inline-start: 2px solid
        light-dark(
          var(--txtColor, var(--fallback-txt-color)),
          var(--txtColorDark, var(--fallback-txt-color-dark))
        );
    }

    @supports not (color: light-dark(white, black)) {
      border-inline-start: 2px solid var(--txtColor, var(--fallback-txt-color));

      @media (prefers-color-scheme: dark) {
        border-inline-start-color: var(
          --txtColorDark,
          var(--fallback-txt-color-dark)
        );
      }
    }
  }

  .reading-highlight p {
    margin: 0;
    margin-block-end: 0.5em;
  }

  .reading-highlight cite {
    display: block;
    font-style: normal;
    opacity: 0.6;
  }

  .highlight-missing {
    color: #c00;
    font-style: italic;
  }
</style>

<Base
  pageTitle={pageTitle}
  bgColor={bgColor}
  txtColor={txtColor}
  bgColorDark={bgColorDark}
  txtColorDark={txtColorDark}
  articleAuthor="Édouard Urcades"
  articlePublishedTime={pubDateISO}
  articleDescription={frontmatter.description}
>
  <!-- JSON-LD structured data -->
  <script is:inline type="application/ld+json" set:html={JSON.stringify(jsonLd)} />

  <p><a href="/writing/">Back to All Writing</a></p>
  <article>
    <header>
      <h1>{frontmatter.title}</h1>
    </header>
    <slot />
    <footer>
      <p>~</p>
      <p>Title: {frontmatter.title}</p>
      <p>Description: {frontmatter.description}</p>
      <p>Published: {frontmatter.pubDate}</p>
      <p>~</p>
    </footer>
  </article>
  <nav>
    <p><a href="/writing/">Back to All Writing</a></p>
    <p><a href="https://urcades.substack.com/">Subscribe</a></p>
    <p><a href="/rss.xml">RSS</a></p>
  </nav>
</Base>
